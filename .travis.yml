language: node_js
node_js:
- '10'
cache:
  directories:
  - "~/.cache"
install: yarn install --frozen-lockfile
script:
- yarn build:dev
- mkdir $TRAVIS_BUILD_DIR/dsource
- cp appspec.yml $TRAVIS_BUILD_DIR/dist
- cd $TRAVIS_BUILD_DIR/dist
- zip -r latest *
- mv latest.zip $TRAVIS_BUILD_DIR/dsource/latest.zip
- cp $TRAVIS_BUILD_DIR/dsource/latest.zip $TRAVIS_BUILD_DIR/dsource/$TRAVIS_COMMIT.zip
deploy:
- provider: s3
  access_key_id: "$ACCESS_KEY_ID"
  secret_access_key: "$SECRET_ACCESS_KEY"
  bucket: endpass-dev-apps
  region: us-east-1
  skip_cleanup: true
  local_dir: $TRAVIS_BUILD_DIR/dsource/
  upload-dir: browser
  on:
    branch: master
- provider: codedeploy
  access_key_id: "$ACCESS_KEY_ID"
  secret_access_key: "$SECRET_ACCESS_KEY"
  bucket: endpass-dev-apps
  region: us-east-1
  key: browser/latest.zip
  bundle: zip
  application: browser-dev-app
  deployment_group: browser-dev-deployment-group
  on:
    branch: master
